"use strict";function newGame(){init(),generateNumber(),generateNumber(),score=0,showScore(score)}function init(){for(var e=0;e<4;e++)for(var r=0;r<4;r++){var o="#grid-cell-"+e+"-"+r,a=$(o);a.css({top:getCellPosition(e),left:getCellPosition(r)})}for(var n=0;n<4;n++){board[n]=new Array,hasAdded[n]=new Array;for(var t=0;t<4;t++)board[n][t]=0,hasAdded[n][t]=!1}upNumberToGrid()}function generateNumber(){if(noSpace(board))return!1;for(var e=parseInt(4*Math.random()),r=parseInt(4*Math.random());;){if(0==board[e][r])break;e=parseInt(4*Math.random()),r=parseInt(4*Math.random())}var o=Math.random()<.5?2:4;return board[e][r]=o,showNumberToGrid(e,r,o),!0}function noSpace(e){for(var r=0;r<4;r++)for(var o=0;o<4;o++)if(0==e[r][o])return!1;return!0}function showNumberToGrid(e,r,o){var a=$("#number-cell-"+e+"-"+r);a.css({color:getColor(o),"background-color":getBackgroundColor(o)}).text(o),a.animate({width:100,height:100,top:getCellPosition(e),left:getCellPosition(r)},200)}function upNumberToGrid(){$(".number-cell").remove();for(var e=0;e<4;e++)for(var r=0;r<4;r++){$("#grid").append('<div class="number-cell" id="number-cell-'+e+"-"+r+'"></div>');var o=$("#number-cell-"+e+"-"+r);0==board[e][r]?o.css({width:0,height:0,top:getCellPosition(e)+50,left:getCellPosition(r)+50}):o.css({width:100,height:100,top:getCellPosition(e),left:getCellPosition(r),color:getColor(board[e][r]),"background-color":getBackgroundColor(board[e][r])}).text(board[e][r]),hasAdded[e][r]=!1}}function moveLeft(){if(canMoveLeft(board)){for(var e=0;e<4;e++)for(var r=1;r<4;r++)if(0!=board[e][r])for(var o=0;o<r;o++)if(noBlockRow(e,o,r,board)){if(0==board[e][o]){moveNumberCell(e,r,e,o),board[e][o]=board[e][r],board[e][r]=0;continue}if(board[e][o]==board[e][r]&&!hasAdded[e][o]){moveNumberCell(e,r,e,o),board[e][o]=2*board[e][r],board[e][r]=0,hasAdded[e][o]=!0,score+=board[e][o],showScore(score);continue}}return setTimeout("upNumberToGrid()",200),!0}return!1}function canMoveLeft(e){for(var r=0;r<4;r++)for(var o=1;o<4;o++)if(0!=e[r][o]&&(0==e[r][o-1]||e[r][o]==e[r][o-1]))return!0;return!1}function moveTop(){if(canMoveTop(board)){for(var e=1;e<4;e++)for(var r=0;r<4;r++)if(0!=board[e][r])for(var o=0;o<e;o++)if(noBlockCol(o,e,r,board)){if(0==board[o][r]){moveNumberCell(e,r,o,r),board[o][r]=board[e][r],board[e][r]=0;continue}if(board[o][r]==board[e][r]&&!hasAdded[o][r]){moveNumberCell(e,r,o,r),board[o][r]=2*board[e][r],board[e][r]=0,hasAdded[o][r]=!0,score+=board[o][r],showScore(score);continue}}return setTimeout("upNumberToGrid()",200),!0}return!1}function canMoveTop(e){for(var r=1;r<4;r++)for(var o=0;o<4;o++)if(0!=e[r][o]&&(0==e[r-1][o]||e[r][o]==e[r-1][o]))return!0;return!1}function moveRight(){if(canMoveRight(board)){for(var e=0;e<4;e++)for(var r=2;r>=0;r--)if(0!=board[e][r])for(var o=3;o>r;o--)if(noBlockRow(e,r,o,board)){if(0==board[e][o]){moveNumberCell(e,r,e,o),board[e][o]=board[e][r],board[e][r]=0;continue}if(board[e][o]==board[e][r]&&!hasAdded[e][o]){moveNumberCell(e,r,e,o),board[e][o]=2*board[e][r],board[e][r]=0,hasAdded[e][o]=!0,score+=board[e][o],showScore(score);continue}}return setTimeout("upNumberToGrid()",200),!0}return!1}function canMoveRight(e){for(var r=0;r<4;r++)for(var o=2;o>=0;o--)if(0!=e[r][o]&&(0==e[r][o+1]||e[r][o]==e[r][o+1]))return!0;return!1}function moveDown(){if(canMoveDown(board)){for(var e=2;e>=0;e--)for(var r=0;r<4;r++)if(0!=board[e][r])for(var o=3;o>e;o--)if(noBlockCol(e,o,r,board)){if(0==board[o][r]){moveNumberCell(e,r,o,r),board[o][r]=board[e][r],board[e][r]=0;continue}if(board[o][r]==board[e][r]&&!hasAdded[o][r]){moveNumberCell(e,r,o,r),board[o][r]=2*board[e][r],board[e][r]=0,hasAdded[o][r]=!0,score+=board[o][r],showScore(score);continue}}return setTimeout("upNumberToGrid()",200),!0}return!1}function canMoveDown(e){for(var r=2;r>=0;r--)for(var o=0;o<4;o++)if(0!=e[r][o]&&(0==e[r+1][o]||e[r][o]==e[r+1][o]))return!0;return!1}function moveNumberCell(e,r,o,a){$("#number-cell-"+e+"-"+r).animate({top:getCellPosition(o),left:getCellPosition(a)},200)}function noBlockRow(e,r,o,a){for(var n=r+1;n<o;n++)if(0!=a[e][n])return!1;return!0}function noBlockCol(e,r,o,a){for(var n=e+1;n<r;n++)if(0!=a[n][o])return!1;return!0}function isGameOver(){noMove(board)&&(alert("Game Over!"),newGame())}function noMove(e){return!(canMoveLeft(e)||canMoveTop(e)||canMoveRight(e)||canMoveDown(e))}function showScore(e){$("#score").html(e)}function getCellPosition(e){return 115*e+15}function getColor(e){return e<=4?"#776e65":"#f9f6f2"}function getBackgroundColor(e){switch(e){case 2:return"#eee4da";case 4:return"#ede0c8";case 8:return"#f2b179";case 16:return"#f59563";case 32:return"#f67c5f";case 64:return"#f65e3b";case 128:return"#edcf72";case 256:return"#edcc61";case 512:return"#edc850";case 1024:return"#edc53f";case 2048:return"#edc22e";default:return"#3c3a32"}}var board=new Array,hasAdded=new Array,score=0;$(function(){newGame(),$("#new-game").click(newGame),$(document).keydown(function(e){switch(e.keyCode){case 37:moveLeft()&&(setTimeout("generateNumber()",200),setTimeout("isGameOver()",400));break;case 38:moveTop()&&(setTimeout("generateNumber()",200),setTimeout("isGameOver()",400));break;case 39:moveRight()&&(setTimeout("generateNumber()",200),setTimeout("isGameOver()",400));break;case 40:moveDown()&&(setTimeout("generateNumber()",200),setTimeout("isGameOver()",400))}})});